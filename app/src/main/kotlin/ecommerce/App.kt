/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package ecommerce

import jakarta.persistence.Entity
import jakarta.persistence.GeneratedValue
import jakarta.persistence.Id
import jakarta.persistence.Persistence
import jakarta.validation.constraints.NotNull

class App {
    val greeting: String
        get() {
            val emFactory = Persistence.createEntityManagerFactory("ecommerce")
            val em = emFactory.createEntityManager()
            em.transaction.begin()
            val msg = Message(text = null)
            em.persist(msg)
            em.transaction.commit()

            em.transaction.begin()
            val messages = em.createQuery("select m from Message m", Message::class.java).resultList
            messages.last().text = "after"
            em.transaction.commit()
            em.close()
            emFactory.close()

            return "Hello World to '${msg.text}'!"
        }
}

fun main() {
    println(App().greeting)
}

@Entity
class Message(
    @Id
    @GeneratedValue
    val id: Long? = null,
    @field:NotNull
    var text: String?,
)
